# 強度変化が基本周波数になるか - 計算の簡略化

## ベッセル関数の重要な性質

ベッセル関数には以下の重要な性質があり、これらを利用して計算を簡略化できます。

### 1. 総和公式

$$\sum_{n=-\infty}^{\infty} J_n(z)^2 = 1$$

### 2. 直交関係

$$\sum_{n=-\infty}^{\infty} J_{n+m}(z)J_{n+k}(z) = \delta_{m,k}$$

ここで $\delta_{m,k}$ はクロネッカーのデルタで、$m=k$ のとき1、それ以外は0です。

### 3. 漸化式

$$J_{n-1}(z) + J_{n+1}(z) = \frac{2n}{z}J_n(z)$$

$$J_{n-1}(z) - J_{n+1}(z) = 2J_n^{\prime}(z)$$

### 4. 小さな引数に対する近似

$z$ が小さいとき（心臓の動きは微小なので適用可能）：

$$J_0(z) \approx 1 - \frac{z^2}{4}$$

$$J_1(z) \approx \frac{z}{2}$$

$$J_n(z) \approx \frac{1}{n!}\left(\frac{z}{2}\right)^n \quad (n \geq 2)$$

## 簡略化した計算

### DC を除いた単振動物体の IQ 波形の強度変化

元の式：
$$\|s^{\prime}(t)\|^2 = 1 - \hat{J}_0^2 - 4\hat{J}_0 \sum_{n=1}^{\infty} \hat{J}_{2n} \cos(2n\omega t)$$

$d_0$ が小さい場合（心臓の動きは微小）、ベッセル関数の小さな引数に対する近似を使用できます：

$$\hat{J}_0 = J_0(2kd_0) \approx 1 - \frac{(2kd_0)^2}{4} = 1 - k^2d_0^2$$

$$\hat{J}_2 = J_2(2kd_0) \approx \frac{1}{2!}\left(\frac{2kd_0}{2}\right)^2 = \frac{(kd_0)^2}{2}$$

$$\hat{J}_{2n} \approx \frac{1}{(2n)!}\left(\frac{2kd_0}{2}\right)^{2n} = \frac{(kd_0)^{2n}}{(2n)!} \quad (n \geq 2)$$

これらを元の式に代入すると：

$$\|s^{\prime}(t)\|^2 \approx 1 - (1 - k^2d_0^2)^2 - 4(1 - k^2d_0^2)\left[\frac{(kd_0)^2}{2}\cos(2\omega t) + \frac{(kd_0)^4}{24}\cos(4\omega t) + \ldots\right]$$

$d_0$ が十分小さい場合、高次の項は無視でき、主要な周波数成分は $2\omega$ となります：

$$\|s^{\prime}(t)\|^2 \approx 2k^2d_0^2 - 2(kd_0)^2\cos(2\omega t)$$

これは定数項と $2\omega$ の周波数成分のみを含む簡略化された式です。

### 片側周波数の強度変化

元の式：
$$\|s_+(t)\|^2 = \sum_{n=0}^{\infty} J_n^2(2kd_0) + 2\sum_{k=1}^{\infty}\left(\sum_{n=0}^{\infty} J_n(2kd_0)J_{n+k}(2kd_0)\right)\cos(k\omega t)$$

ベッセル関数の直交関係を利用すると、内側の無限和を簡略化できます：

$$\sum_{n=0}^{\infty} J_n(z)J_{n+k}(z) = \frac{1}{2}\left[\sum_{n=-\infty}^{\infty} J_n(z)J_{n+k}(z) - \sum_{n=-\infty}^{-1} J_n(z)J_{n+k}(z)\right]$$

直交関係より、$k \neq 0$ のとき $\sum_{n=-\infty}^{\infty} J_n(z)J_{n+k}(z) = 0$ です。

また、$J_{-n}(z) = (-1)^n J_n(z)$ を使って負のインデックスを正に変換できます：

$$\sum_{n=-\infty}^{-1} J_n(z)J_{n+k}(z) = \sum_{m=1}^{\infty} J_{-m}(z)J_{-m+k}(z) = \sum_{m=1}^{\infty} (-1)^m J_m(z)(-1)^{m-k}J_{m-k}(z)$$

$k$ が偶数のとき、これは $(-1)^k \sum_{m=1}^{\infty} J_m(z)J_{m-k}(z)$ となります。

$d_0$ が小さい場合、低次の項のみを考慮すれば十分です：

$$\|s_+(t)\|^2 \approx J_0^2(2kd_0) + J_1^2(2kd_0) + 2J_0(2kd_0)J_1(2kd_0)\cos(\omega t)$$

近似式を使うと：

$$\|s_+(t)\|^2 \approx (1 - k^2d_0^2)^2 + (kd_0)^2 + 2(1 - k^2d_0^2)(kd_0)\cos(\omega t)$$

$d_0$ が十分小さい場合：

$$\|s_+(t)\|^2 \approx 1 + 2kd_0\cos(\omega t)$$

これは基本周波数 $\omega$ の成分が主要となることを示しています。

## 実用的な計算のための有限和近似

実際の計算では、ベッセル関数の値が急速に小さくなる性質を利用して、有限項で近似できます。$2kd_0$ が小さい場合（例：$2kd_0 < 1$）、以下の近似が有効です：

1. **DC を除いた強度変化**:
   $$\|s^{\prime}(t)\|^2 \approx 1 - \hat{J}_0^2 - 4\hat{J}_0 \sum_{n=1}^{N} \hat{J}_{2n} \cos(2n\omega t)$$
   
   ここで $N = 2$ または $3$ で十分な精度が得られます。

2. **片側周波数の強度変化**:
   $$\|s_+(t)\|^2 \approx \sum_{n=0}^{M} J_n^2(2kd_0) + 2\sum_{k=1}^{K}\left(\sum_{n=0}^{M-k} J_n(2kd_0)J_{n+k}(2kd_0)\right)\cos(k\omega t)$$
   
   ここで $M = 3$ または $4$、$K = 3$ で十分な精度が得られます。

## 心拍数推定のための実用的な近似

心拍数推定の観点から、最も重要なのは強度変化の主要周波数成分です。$d_0$ が小さい場合：

1. DC を除いた強度変化では、$2\omega$ の周波数成分が最も強くなります。
2. 片側周波数の強度変化では、$\omega$ の周波数成分が最も強くなります。

したがって、心拍数推定アルゴリズムでは：

- DC を除いた全周波数の強度変化を使用する場合、検出された周波数の半分が心拍数となります。
- 片側周波数の強度変化を使用する場合、検出された周波数がそのまま心拍数となります。

これらの近似を用いることで、計算量を大幅に削減しながら、心拍数推定に必要な精度を維持できます。