# 同期検波の効果と理論

## 1. 問題設定

対象信号を

$$
x(t)=\sin(2\pi f_1 t)+\sin(2\pi f_2 t)
$$

とします。時間領域ではうなりが見え、単純な帯域フィルタだけでは不要成分の漏れにより振幅が差周波で揺れることがあります。

差周波は

$$
\Delta f = |f_2-f_1|
$$

です。

## 2. 同期検波の基本原理

抽出したい周波数を $f_0$ とし、局部発振器 (LO) を

$$
\cos(2\pi f_0 t),\ \sin(2\pi f_0 t)
$$

として入力信号に掛けます。

I/Q ミキシング:

$$
I_{\mathrm{mix}}(t)=2x(t)\cos(2\pi f_0 t)
$$

$$
Q_{\mathrm{mix}}(t)=-2x(t)\sin(2\pi f_0 t)
$$

この後、低域通過フィルタ (LPF) をかけてベースバンド成分のみ残します。

$$
I(t)=\mathrm{LPF}\{I_{\mathrm{mix}}(t)\},\quad
Q(t)=\mathrm{LPF}\{Q_{\mathrm{mix}}(t)\}
$$

振幅推定値は

$$
A(t)=\sqrt{I(t)^2+Q(t)^2}
$$

で求まります。

## 3. なぜうなりの揺れが減るのか

$f_0=f_1$ とすると、$f_1$ 成分はミキシング後に DC 近傍へ移動し、$f_2$ 成分は $\Delta f$ 近傍へ移動します。  
したがって、ベースバンド LPF のカットオフ $f_c$ を

$$
f_c < \Delta f
$$

に設定すると、$f_2$ 由来の成分を強く抑制でき、$A(t)$ の周期揺れが小さくなります。

逆に

$$
f_c \approx \Delta f \ \text{または}\ f_c > \Delta f
$$

では、不要成分が残りやすく、推定振幅に揺れが見えます。

## 4. このリポジトリ実装との対応

`wave_mixing.py` の `synchronous_demodulate()` は次を実装しています。

1. $I_{\mathrm{mix}}, Q_{\mathrm{mix}}$ の生成  
2. Butterworth LPF (`sosfiltfilt`) によるベースバンド抽出  
3. $A(t)=\sqrt{I^2+Q^2}$ の算出  
4. 復元波形

$$
\hat{x}(t)=I(t)\cos(2\pi f_0 t)-Q(t)\sin(2\pi f_0 t)
$$

の生成

## 5. 実務上の設計指針

- $f_0$ は抽出したい搬送周波数に合わせる  
- $f_c$ は不要成分との周波数間隔より十分低くする  
- LPF 次数を上げると分離は改善するが過渡応答は長くなる  
- オフライン解析では `filtfilt` により位相歪みを抑えられる

## 6. 補足

同期検波は「狙った周波数だけを 0 Hz 付近にシフトしてから取り出す」ため、単純バンドパスより振幅推定が安定しやすい手法です。  
ただし、$f_0$ のずれ、LPF 設定、S/N によって性能は変化します。

