# 局所接線の逐次積分による測地距離推定の理論

本章では、Isomap を明示的に解かずに、**局所的な情報のみから曲線上の大局的 1 次元座標（測地距離）を復元できる理由**を数理的に説明する。

---

## 問題設定

観測データは、ノイズを含みつつ 2 次元空間内の 1 次元曲線の近傍を動く時系列とする。

$$
x(t) \in \mathbb{R}^2, \quad t = 0,1,2,\dots
$$

真の運動は、未知の滑らかな曲線 $\gamma(s)$ 上で起きていると仮定する。

$$
x(t) = \gamma(s(t)) + \varepsilon(t)
$$

ここで

- $s(t) \in \mathbb{R}$ は曲線に沿った位置（弧長パラメータ）
- $\varepsilon(t)$ は観測ノイズ

重要なのは、**自由度が 1** である点である。

---

## 大局的に求めたい量

Isomap や主曲線が最終的に求めたい量は、点が曲線に沿ってどれだけ進んだかを表す 1 次元量 $s(t)$ である。

弧長の定義より、

$$
s(t) = \int_0^t \left\| \frac{d\gamma}{d\tau} \right\| d\tau
$$

これは本質的に **局所量の積分** である。

---

## 局所近似と接線方向

時間差分を考えると、

$$
x(t+1) - x(t)
\approx \gamma'(s(t)) \, \Delta s(t)
$$

ここで

- $\gamma'(s)$ は曲線の接線ベクトル
- $\Delta s(t) = s(t+1) - s(t)$

接線の単位ベクトルを

$$
u(t) = \frac{\gamma'(s(t))}{\|\gamma'(s(t))\|}
$$

とすると、微小な進行量は

$$
\Delta s(t) \approx (x(t+1)-x(t))^\top u(t)
$$

となる。

---

## なぜ局所 PCA で接線が推定できるか

$s(t)$ の近傍で曲線をテイラー展開すると、

$$
\gamma(s+\delta)
= \gamma(s) + \gamma'(s)\delta + O(\delta^2)
$$

十分小さい近傍では、点群の分散は

- 接線方向：$O(\delta^2)$
- 法線方向：$O(\delta^4)$

となる。

したがって、局所点群の共分散行列の最大固有値に対応する固有ベクトルは、接線方向 $\gamma'(s)$ と一致する。

これは PCA の定義そのものである。

---

## 測地距離の逐次更新式

以上より、測地距離（1 次元座標）は次の逐次式で更新できる。

$$
s(t+1) = s(t) + (x(t+1)-x(t))^\top u(t)
$$

これは Isomap がグラフ最短路距離として一括で計算していた量を、**微分形で逐次積分している**と解釈できる。

---

## 誤差が累積破綻しない理由

推定された接線には誤差が含まれる。

$$
u(t) = u_{\text{true}}(t) + \delta u(t)
$$

このとき誤差項の寄与は

$$
\sum_t (x(t+1)-x(t))^\top \delta u(t)
$$

となるが、$\delta u(t)$ は

- 高周波的
- 符号が揺れやすい
- 平均がほぼ 0

という性質を持つため、積分後の $s(t)$ には **低周波成分（位相・進行量）が安定して残る**。

---

## なぜ大局構造が局所情報で決まるのか

以下の条件が満たされるとき、

1. 多様体が 1 次元
2. 自己交差がない
3. 曲線が連続・滑らか
4. 近傍サイズが曲率半径より十分小さい

接線方向と進行方向は局所的に一意であり、積分経路も一意に定まる。

したがって、

> 大局的な曲線上の座標は、局所接線の積分として完全に決定される。

---

## Isomap との関係

Isomap は、点間の測地距離を

$$
D_{ij} \approx \sum_{\text{path } i\to j} \|x_{k+1}-x_k\|
$$

として一括で推定する。

本手法はこれを

$$
\text{積分の逐次実行}
$$

として書き直したものに過ぎない。

---

## 解釈（信号処理的視点）

$s(t)$ は幾何学的な位相量であり、

$$
\phi(t) = \int \omega(t)\,dt
$$

と同型である。

したがって本手法は、

> 非線形空間上で定義された「瞬時周波数」を積分して位相を得る操作

として理解できる。

---

## まとめ

- 1 次元多様体では、局所接線が本質情報をすべて含む
- 大局的な測地距離は、その積分である
- Isomap は距離を一括計算する
- 本手法は距離を逐次積分する
- そのため、局所処理だけで大局的構造が復元できる

---

## 円弧・楕円の場合に理論がどのように簡約されるか

前章までの議論は、一般の滑らかな 1 次元曲線 $\gamma(s)$ を対象としていた。
しかし、曲線が **円弧** や **楕円弧** である場合、この理論はさらに単純な形に落ちる。

---

### 円弧の場合

円弧は、中心 $c \in \mathbb{R}^2$、半径 $r$ を用いて

$$
\gamma(\theta) = c + r
\begin{bmatrix}
\cos\theta \\
\sin\theta
\end{bmatrix}
$$

と表せる。

このとき接線は

$$
\gamma'(\theta) =
r
\begin{bmatrix}
-\sin\theta \\
\cos\theta
\end{bmatrix}
$$

であり、単位接線ベクトルは

$$
u(\theta) =
\begin{bmatrix}
-\sin\theta \\
\cos\theta
\end{bmatrix}
$$

となる。

時間差分に対する射影は

$$
(x(t+1)-x(t))^\top u(\theta(t))
\approx r \, (\theta(t+1)-\theta(t))
$$

したがって逐次更新式は

$$
s(t+1) = s(t) + r \, \Delta\theta(t)
$$

となり、方法Bは

> 「角度変化を積分して弧長を得る」

操作と**完全に一致**する。

すなわち、円弧の場合、局所 PCA による接線推定は
解析的に既知な接線方向を数値的に再現しているだけである。

---

### 楕円弧の場合

楕円は

$$
\gamma(\phi) =
c +
R
\begin{bmatrix}
a\cos\phi \\
b\sin\phi
\end{bmatrix}
$$

（$R$ は回転行列）と表せる。

このとき接線は

$$
\gamma'(\phi) =
R
\begin{bmatrix}
- a \sin\phi \\
\;\; b \cos\phi
\end{bmatrix}
$$

となり、速度ノルムは

$$
\|\gamma'(\phi)\| =
\sqrt{
a^2 \sin^2\phi + b^2 \cos^2\phi
}
$$

よって弧長は

$$
s(\phi) =
\int \|\gamma'(\phi)\| d\phi
$$

で定義され、$\phi$ に対して非線形となる。

方法Bの逐次更新は

$$
s(t+1) = s(t) + (x(t+1)-x(t))^\top u(t)
$$

であり、これは

> 楕円上の「不均一な角速度」を自動的に補正しながら弧長を積分している

と解釈できる。

---

### 円弧・楕円における Isomap / 主曲線 / 方法B の関係

これらを整理すると：

- **円弧**
  - Isomap 1D：弧長と線形同値
  - 主曲線：円そのもの
  - 方法B：角度差分の積分

- **楕円弧**
  - Isomap 1D：弧長に単調対応
  - 主曲線：楕円曲線
  - 方法B：速度重み付き角度積分

いずれの場合も、

> 大局的 1D 座標は「接線方向への局所射影の積分」

として統一的に表現できる。

---

### 重要な含意

円弧・楕円という解析的に扱える例においても、

- 方法Bは既知解と一致する
- PCA が失う「曲率情報」を保持する
- 位相推定として自然に解釈できる

ことが確認できる。

したがって本理論は、

> 一般曲線のための近似理論であると同時に、
> 円・楕円に対する厳密理論の自然な拡張

と位置づけられる。
